const http = require('http');\nconst { exec } = require('child_process');\n\nlet cachedActive = 0;\nlet lastUpdate = 0;\n\nconst UPDATE_INTERVAL = 30000; // 30 seconds\n\nfunction updateSessions() {\n  exec('openclaw sessions list', (error, stdout, stderr) => {\n    if (error) {\n      console.error('Error fetching sessions:', error);\n      return;\n    }\n    // Parse: count non-header lines with 'direct'\n    const lines = stdout.split('\\n').filter(line => line.trim() && line.startsWith('direct'));\n    cachedActive = lines.length;\n    lastUpdate = Date.now();\n    console.log(`Updated sessions count: ${cachedActive}`);\n  });\n}\n\nconst server = http.createServer((req, res) => {\n  if (req.url === '/sessions' && req.method === 'GET') {\n    // Update if older than interval\n    if (Date.now() - lastUpdate > UPDATE_INTERVAL) {\n      updateSessions();\n    }\n    res.writeHead(200, { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' });\n    res.end(JSON.stringify({ active: cachedActive }));\n  } else {\n    res.writeHead(404);\n    res.end('Not Found');\n  }\n});\n\nserver.listen(3000, () => {\n  console.log('Office Dashboard Server running on http://localhost:3000');\n  updateSessions(); // Initial update\n  setInterval(updateSessions, UPDATE_INTERVAL);\n});\n